---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";

import Cloud from "@app/components/Cloud.astro";
import Layout from "@app/layouts/Layout.astro";
import Frame from "@app/components/Frame.astro";

import arrowLeft from "@app/assets/arrow-left.webp";
import arowRight from "@app/assets/arrow-right.webp";
import Infobox from "@app/components/Infobox.astro";
import { createSlug } from "@app/util/create-slug";

export async function getStaticPaths() {
  const projects = await getCollection("projects");
  return projects.map((entry) => ({
    params: {
      slug: `${entry.data.date.getFullYear()}-${createSlug(entry.data.title)}`,
    },
    props: { entry },
  }));
}

const { entry } = Astro.props;
---

<Layout title={entry.data.title} showTagline={false}>
  <Cloud title={entry.data.title} slot="header" />

  <!-- Icon -->
  <section class="container">
    <div class="row justify-content-center">
      <div class="col-6 col-md-6 col-lg-4">
        <Image
          src={entry.data.icon}
          alt={`Illustration von ${entry.data.title}`}
        />
      </div>
    </div>
  </section>

  <!-- Gallery -->
  {
    entry.data.gallery && (
      <section class="gallery-container">
        <div class="row gx-3">
          <div class="col-1 d-flex justify-content-center">
            <button class="button-previous">
              <Image src={arrowLeft} alt="Vorheriges Bild" />
            </button>
          </div>
          <div class="col-10">
            <Frame>
              <div class="slide-container">
                {entry.data.gallery.map(({ imageAndDescription }) => (
                  <img
                    src={imageAndDescription.image.src}
                    alt={imageAndDescription.description}
                  />
                ))}
              </div>
            </Frame>
          </div>
          <div class="col-1 d-flex justify-content-center">
            <button class="button-next">
              <Image src={arowRight} alt="NÃ¤chstes Bild" />
            </button>
          </div>
        </div>
      </section>
    )
  }

  <!-- Info -->

  <div class="container mt-4">
    <div class="row justify-content-center">
      <div class="col-10">
        <Infobox>
          <p>{entry.data.date.getFullYear()}</p>
          <p class="m-0">{entry.data.description}</p>

          {
            entry.data.links && (
              <p>
                <ul class="list-unstyled">
                  {entry.data.links.map(({ linkAndTitle }) => (
                    <li>
                      <a href={linkAndTitle.link} target="_blank">
                        {linkAndTitle.linkTitle}
                      </a>
                    </li>
                  ))}
                </ul>
              </p>
            )
          }
        </Infobox>
      </div>
    </div>
  </div>
</Layout>

<style>
  button {
    background: transparent;
    border: none;
    padding: 0;
  }

  .slide-container {
    width: 100%;
    height: 100%;
    overflow: hidden;
    display: flex;
  }
  img {
    width: 100%;
    height: auto;
  }

  .gallery-container {
    background-color: var(--color-blue);
    padding: 2rem;
  }

  /* .gallery-container img {
    width: 99%;
    height: auto;
  } */
</style>

<script>
  const previous = document.querySelector("button.button-previous");
  const next = document.querySelector("button.button-next");

  // previous.
</script>
